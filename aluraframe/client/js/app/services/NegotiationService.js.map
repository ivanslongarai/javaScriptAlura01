{"version":3,"sources":["../../app-es6/services/NegotiationService.js"],"names":["HttpService","ConnectionFactory","NegotiationDAO","Negotiation","NegotiationService","_http","Promise","resolve","reject","get","then","negotiations","map","Date","object","date","amount","price","catch","console","log","err","negotiation","getConnection","connection","dao","add","Error","listAll","clearList","all","getWeekNegotiations","getPreviousNegotiations","getDelayedNegotiations","times","reduce","records","periodo","concat","record","actualNegotiations","getNegotiations","filter","some","JSON","stringify","negotiationSome"],"mappings":"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","file":"NegotiationService.js","sourcesContent":["import {HttpService} from \"./HttpService\";\r\nimport {ConnectionFactory} from \"./ConnectionFactory\";\r\nimport {NegotiationDAO} from \"../dao/NegotiationDAO\";\r\nimport {Negotiation} from \"../models/Negotiation\";\r\n\r\nexport class NegotiationService {\r\n\r\n    constructor() {\r\n        this._http = new HttpService();\r\n    }\r\n\r\n    getWeekNegotiations() {\r\n        return new Promise((resolve, reject) => {\r\n            this._http.get(\"http://localhost:3000/negotiations/week\")\r\n                .then(negotiations => {\r\n                    resolve(negotiations.map(object => new Negotiation(new Date(object.date), object.amount, object.price)))\r\n                })\r\n                .catch(err => {\r\n                    console.log(err);\r\n                    reject(\"Não foi possível obter as negociações da semana.\");\r\n                });\r\n        });\r\n    }\r\n\r\n    getPreviousNegotiations() {\r\n        return new Promise((resolve, reject) => {\r\n            this._http.get(\"http://localhost:3000/negotiations/previous\")\r\n                .then(negotiations => {\r\n                    resolve(negotiations.map(object => new Negotiation(new Date(object.date), object.amount, object.price)))\r\n                })\r\n                .catch(err => {\r\n                    console.log(err);\r\n                    reject(\"Não foi possível obter as negociações da semana anterior.\");\r\n                });\r\n        });\r\n    }\r\n\r\n    getDelayedNegotiations() {\r\n        return new Promise((resolve, reject) => {\r\n            this._http.get(\"http://localhost:3000/negotiations/delayed\")\r\n                .then(negotiations => {\r\n                    resolve(negotiations.map(object => new Negotiation(new Date(object.date), object.amount, object.price)))\r\n                })\r\n                .catch(err => {\r\n                    console.log(err);\r\n                    reject(\"Não foi possível obter as negociações da semana retrasada.\");\r\n                });\r\n        });\r\n    }\r\n\r\n    add(negotiation) {\r\n        return ConnectionFactory.getConnection()\r\n            .then(connection => new NegotiationDAO(connection))\r\n            .then(dao => dao.add(negotiation))\r\n            .then(() => \"Negociação incluída com sucesso\")\r\n            .catch(err => {\r\n                console.log(err);\r\n                throw new Error(\"Não foi possível inserir a negociação.\");\r\n            })\r\n    }\r\n\r\n    listAll() {\r\n        return ConnectionFactory\r\n            .getConnection()\r\n            .then(connection => new NegotiationDAO(connection))\r\n            .then(dao => dao.listAll())\r\n            .catch(err => {\r\n                console.log(err);\r\n                throw new Error(\"Não foi possível obter as negociações\");\r\n            });\r\n    }\r\n\r\n    clearList() {\r\n        return ConnectionFactory\r\n            .getConnection()\r\n            .then(connection => new NegotiationDAO(connection))\r\n            .then(dao => dao.clearList())\r\n            .then(() => \"Negociações excluídas com sucesso.\")\r\n            .catch(err => {\r\n                console.log(err);\r\n                throw new Error(\"Não foi possível excluir a lista de negociações\");\r\n            });\r\n    }\r\n\r\n    getNegotiations() {\r\n        return Promise.all([\r\n            this.getWeekNegotiations(),\r\n            this.getPreviousNegotiations(),\r\n            this.getDelayedNegotiations()\r\n        ]).then(times => {\r\n            let negotiations = times\r\n                .reduce((records, periodo) => records.concat(periodo), [])\r\n                .map(record => new Negotiation(new Date(record.date), record.amount, record.price));\r\n            return negotiations;\r\n        }).catch(err => {\r\n            throw new Error(err);\r\n        });\r\n    }\r\n\r\n    importNegotiations(actualNegotiations) {\r\n        return this.getNegotiations()\r\n            .then(negotiations =>\r\n                negotiations.filter(negotiation =>\r\n                    !actualNegotiations.some(negotiationSome =>\r\n                        JSON.stringify(negotiation) == JSON.stringify(negotiationSome))))\r\n            .catch(err => {\r\n                console.log(err);\r\n                throw new Error(\"Não foi possível importar as negociações\");\r\n            })\r\n    }\r\n\r\n}"]}